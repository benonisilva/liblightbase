#!/usr/env python
# -*- coding: utf-8 -*-
import re

class reify(object):
    """ Use as a class method decorator.  It operates almost exactly like the
    Python ``@property`` decorator, but it puts the result of the method it
    decorates into the instance dict after the first call, effectively
    replacing the function it decorates with an instance variable.  It is, in
    Python parlance, a non-data descriptor."""

    def __init__(self, wrapped):
        self.wrapped = wrapped
        try:
            self.__doc__ = wrapped.__doc__
        except:
            pass

    def __get__(self, inst, objtype=None):
        if inst is None:
            return self
        val = self.wrapped(inst)
        setattr(inst, self.wrapped.__name__, val)
        return val

def validate_url(url):
    #http://stackoverflow.com/questions/7160737/python-how-to-validate-a-url-in-python-malformed-or-not
    _url = None
    regex = re.compile(
        r'^(?:http|ftp)s?://' # http:// or https://
        r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|' #domain...
        r'localhost|' #localhost...
        r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})' # ...or ip
        r'(?::\d+)?' # optional port
        r'(?:/?|[/?]\S+)$', re.IGNORECASE)
    try: _url = regex.match(url)
    except: pass
    if _url:
        return _url.string
    else:
        raise ValueError('"%s" is not a valid url' % url)

def validate_required(rnames, kwargs):
    a = set(rnames)
    b = set(kwargs.keys())
    if len(a-b) > 0:
        msg = 'Required structure {} not provided'.format(a-b)
        raise TypeError(msg)

def get_attr(obj):
    """
    Get a dict with attributes and types
    :param obj: Python object
    :return: List with elements
    """
    out = []
    for elm in obj.__dict__.keys():
        out.append((elm,
        type(obj.__dict__.get(elm)),
        getattr(obj, elm)))
    return out
